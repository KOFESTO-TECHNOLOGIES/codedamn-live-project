(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{60:function(e,t,a){e.exports=a(75)},65:function(e,t,a){},66:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){},75:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(7),o=a.n(c),l=(a(65),a(24)),i=a(10),s=a(102);a(66);function u(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("h1",null,"Simple Chat Room App"),r.a.createElement("div",{className:"buttons"},r.a.createElement(s.a,{color:"secondary",variant:"contained",component:l.b,to:"/login"},"Login"),r.a.createElement(s.a,{color:"primary",variant:"contained",component:l.b,to:"/register"},"Register"))))}var m=a(20),p=a.n(m),d=a(26),f=a(18),h=a(109),g=(a(73),!("localhost"===window.location.hostname)?"":"http://localhost:1337");function v(e,t){return E.apply(this,arguments)}function E(){return(E=Object(d.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(g).concat(t),{method:"POST",headers:{"Content-Type":"application/json","x-access-token":localStorage.getItem("token")||""},body:JSON.stringify(a)}).then((function(e){return e.json()}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(){var e=Object(n.useState)(""),t=Object(f.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(""),l=Object(f.a)(o,2),u=l[0],m=l[1],g=Object(i.f)();function E(){return(E=Object(d.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/login",{email:a,password:u});case 2:"ok"===(t=e.sent).status?(localStorage.setItem("token",t.data),alert("You are logged in"),g.push("/chat")):alert(t.error);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement("div",{className:"form"},r.a.createElement("h1",null,"Login"),r.a.createElement("form",{className:"register-fields"},r.a.createElement(h.a,{fullWidth:!0,placeholder:"you@awesome.com",label:"Your Email",value:a,onChange:function(e){return c(e.target.value)},variant:"outlined"}),r.a.createElement(h.a,{fullWidth:!0,value:u,onChange:function(e){return m(e.target.value)},placeholder:"p@$$w0rd",label:"Password",variant:"outlined"}),r.a.createElement(s.a,{color:"primary",variant:"contained",onClick:function(){return E.apply(this,arguments)}},"Login")))}a(74);function y(){var e=Object(n.useState)(""),t=Object(f.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)(""),l=Object(f.a)(o,2),i=l[0],u=l[1];function m(){return(m=Object(d.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v("/api/register",{email:a,password:i});case 2:t=e.sent,console.log(t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement("div",{className:"form"},r.a.createElement("h1",null,"Register"),r.a.createElement("form",{className:"register-fields"},r.a.createElement(h.a,{fullWidth:!0,placeholder:"you@awesome.com",label:"Your Email",value:a,onChange:function(e){return c(e.target.value)},variant:"outlined"}),r.a.createElement(h.a,{fullWidth:!0,value:i,onChange:function(e){return u(e.target.value)},placeholder:"p@$$w0rd",label:"Password",variant:"outlined"}),r.a.createElement(s.a,{color:"primary",variant:"contained",onClick:function(){return m.apply(this,arguments)}},"Register")))}var O=a(52),j=a(106),S=a(107),w=a(110),k=a(108),x=a(41);function N(){var e=Object(n.useState)(""),t=Object(f.a)(e,2),a=t[0],c=t[1],o=Object(n.useState)([]),l=Object(f.a)(o,2),u=l[0],m=l[1],p=Object(n.useState)(null),d=Object(f.a)(p,2),g=d[0],v=d[1],E=Object(i.f)();return Object(n.useEffect)((function(){var e=new WebSocket("ws://localhost:1338/"+localStorage.getItem("token"));return e.addEventListener("open",(function(){e.send(JSON.stringify({intent:"old-messages",count:10}))}),{once:!0}),e.addEventListener("error",(function(){alert("Please login first"),E.replace("/login")})),e.addEventListener("message",(function(e){var t=function(e){try{return JSON.parse(e)}catch(t){return null}}(e.data);t&&("chat"===t.intent?m((function(e){return[].concat(Object(O.a)(e),[t])})):"old-messages"===t.intent&&(console.log(t.data,"are the older messages"),m(t.data.map((function(e){return{user:e.email,message:e.message}})).reverse())))})),v(e),function(){e.close()}}),[]),r.a.createElement("div",null,r.a.createElement("h1",null,"Chat Page"),r.a.createElement("div",{className:"chat-box"},u.map((function(e,t){return r.a.createElement(j.a,{alignItems:"flex-start",key:t},r.a.createElement(S.a,null,r.a.createElement(w.a,{alt:"Remy Sharp",src:"/static/images/avatar/1.jpg"})),r.a.createElement(k.a,{primary:e.user,secondary:r.a.createElement(r.a.Fragment,null,r.a.createElement(x.a,{component:"span",variant:"body2",color:"textPrimary"},e.message))}))}))),r.a.createElement(h.a,{onChange:function(e){return c(e.target.value)},value:a,multiline:!0,rows:2,variant:"outlined",color:"primary"}),r.a.createElement(s.a,{variant:"outlined",color:"primary",onClick:function(){(null===g||void 0===g?void 0:g.readyState)===WebSocket.OPEN&&(g.send(JSON.stringify({message:a,intent:"chat"})),c(""))}},"Send Message"))}var C=function(){return r.a.createElement(l.a,null,r.a.createElement(i.c,null,r.a.createElement(i.a,{path:"/",component:u,exact:!0}),r.a.createElement(i.a,{path:"/login",component:b,exact:!0}),r.a.createElement(i.a,{path:"/register",component:y,exact:!0}),r.a.createElement(i.a,{path:"/chat",component:N,exact:!0})))};o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(C,null)),document.getElementById("root"))}},[[60,1,2]]]);
//# sourceMappingURL=main.bb3a1453.chunk.js.map