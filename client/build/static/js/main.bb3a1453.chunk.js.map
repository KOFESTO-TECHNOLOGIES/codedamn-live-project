{"version":3,"sources":["components/Home/index.tsx","utility.ts","components/Login/index.tsx","components/Register/index.tsx","components/Chat/index.tsx","components/index.tsx","index.tsx"],"names":["Home","className","Button","color","variant","component","Link","to","API_URL","window","location","hostname","apiCall","path","payload","a","fetch","method","headers","localStorage","getItem","body","JSON","stringify","then","t","json","res","Register","useState","email","setEmail","password","setPassword","history","useHistory","status","setItem","data","alert","push","error","TextField","fullWidth","placeholder","label","value","onChange","e","target","onClick","console","log","Chat","chatMessage","setChatMessage","chatMessages","setChatMessages","wsRef","setWSRef","useEffect","ws","WebSocket","addEventListener","send","intent","count","once","replace","event","message","parse","processMessage","oldMessages","map","item","user","reverse","close","index","ListItem","alignItems","key","ListItemAvatar","Avatar","alt","src","ListItemText","primary","secondary","Fragment","Typography","multiline","rows","readyState","OPEN","App","exact","Login","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.bb3a1453.chunk.js","sourcesContent":["import React from 'react'\nimport { Button } from '@material-ui/core'\nimport { Link } from 'react-router-dom'\nimport './style.css'\n\nexport default function Home() {\n\treturn (\n\t\t<div className=\"App\">\n\t\t\t<header className=\"App-header\">\n\t\t\t\t<h1>Simple Chat Room App</h1>\n\t\t\t\t<div className=\"buttons\">\n\t\t\t\t\t<Button color=\"secondary\" variant=\"contained\" component={Link} to=\"/login\">\n\t\t\t\t\t\tLogin\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button color=\"primary\" variant=\"contained\" component={Link} to=\"/register\">\n\t\t\t\t\t\tRegister\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</header>\n\t\t</div>\n\t)\n}\n","export const IS_DEVELOPMENT = window.location.hostname === 'localhost'\nexport const IS_PRODUCTION = !IS_DEVELOPMENT\n\nconst API_URL = IS_PRODUCTION ? '' : 'http://localhost:1337'\n\nexport async function apiCall(path: string, payload: { [key: string]: any }) {\n\tconst res = await fetch(`${API_URL}${path}`, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/json',\n\t\t\t'x-access-token': localStorage.getItem('token') || ''\n\t\t},\n\t\tbody: JSON.stringify(payload)\n\t}).then((t) => t.json())\n\n\treturn res\n}\n","import React, { useState } from 'react'\nimport { TextField, Button } from '@material-ui/core'\nimport './style.css'\nimport { apiCall } from '../../utility'\nimport { useHistory } from 'react-router-dom'\n\nexport default function Register() {\n\tconst [email, setEmail] = useState('')\n\tconst [password, setPassword] = useState('')\n\n\tconst history = useHistory()\n\n\tasync function loginUser() {\n\t\tconst res = await apiCall('/api/login', { email, password })\n\n\t\tif (res.status === 'ok') {\n\t\t\t// TODO: Bad practice -> refresh tokens\n\t\t\tlocalStorage.setItem('token', res.data)\n\t\t\talert('You are logged in')\n\t\t\thistory.push('/chat')\n\t\t} else {\n\t\t\talert(res.error)\n\t\t}\n\t}\n\n\treturn (\n\t\t<div className=\"form\">\n\t\t\t<h1>Login</h1>\n\t\t\t<form className=\"register-fields\">\n\t\t\t\t<TextField\n\t\t\t\t\tfullWidth\n\t\t\t\t\tplaceholder=\"you@awesome.com\"\n\t\t\t\t\tlabel=\"Your Email\"\n\t\t\t\t\tvalue={email}\n\t\t\t\t\tonChange={(e: any) => setEmail(e.target.value)}\n\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t/>\n\t\t\t\t<TextField\n\t\t\t\t\tfullWidth\n\t\t\t\t\tvalue={password}\n\t\t\t\t\tonChange={(e: any) => setPassword(e.target.value)}\n\t\t\t\t\tplaceholder=\"p@$$w0rd\"\n\t\t\t\t\tlabel=\"Password\"\n\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t/>\n\t\t\t\t<Button color=\"primary\" variant=\"contained\" onClick={loginUser}>\n\t\t\t\t\tLogin\n\t\t\t\t</Button>\n\t\t\t</form>\n\t\t</div>\n\t)\n}\n","import React, { useState } from 'react'\nimport { TextField, Button } from '@material-ui/core'\nimport './style.css'\nimport { apiCall } from '../../utility'\n\nexport default function Register() {\n\tconst [email, setEmail] = useState('')\n\tconst [password, setPassword] = useState('')\n\n\tasync function registerUser() {\n\t\tconst res = await apiCall('/api/register', { email, password })\n\t\tconsole.log(res)\n\t}\n\n\treturn (\n\t\t<div className=\"form\">\n\t\t\t<h1>Register</h1>\n\t\t\t<form className=\"register-fields\">\n\t\t\t\t<TextField\n\t\t\t\t\tfullWidth\n\t\t\t\t\tplaceholder=\"you@awesome.com\"\n\t\t\t\t\tlabel=\"Your Email\"\n\t\t\t\t\tvalue={email}\n\t\t\t\t\tonChange={(e: any) => setEmail(e.target.value)}\n\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t/>\n\t\t\t\t<TextField\n\t\t\t\t\tfullWidth\n\t\t\t\t\tvalue={password}\n\t\t\t\t\tonChange={(e: any) => setPassword(e.target.value)}\n\t\t\t\t\tplaceholder=\"p@$$w0rd\"\n\t\t\t\t\tlabel=\"Password\"\n\t\t\t\t\tvariant=\"outlined\"\n\t\t\t\t/>\n\t\t\t\t<Button color=\"primary\" variant=\"contained\" onClick={registerUser}>\n\t\t\t\t\tRegister\n\t\t\t\t</Button>\n\t\t\t</form>\n\t\t</div>\n\t)\n}\n","import React, { useEffect, useState } from 'react'\nimport {\n\tTextField,\n\tButton,\n\tListItem,\n\tListItemAvatar,\n\tAvatar,\n\tListItemText,\n\tTypography\n} from '@material-ui/core'\nimport { useHistory } from 'react-router-dom'\n\ntype Message = {\n\tuser: string\n\tmessage: string\n\tintent: 'chat'\n}\n\nfunction processMessage(payload: string) {\n\ttry {\n\t\treturn JSON.parse(payload)\n\t} catch (error) {\n\t\treturn null\n\t}\n}\n\nexport default function Chat() {\n\tconst [chatMessage, setChatMessage] = useState('')\n\tconst [chatMessages, setChatMessages] = useState<Message[]>([])\n\tconst [wsRef, setWSRef] = useState<null | WebSocket>(null)\n\n\tconst history = useHistory()\n\n\tfunction sendMessage() {\n\t\tif (wsRef?.readyState !== WebSocket.OPEN) {\n\t\t\t// websocket not connected\n\t\t\treturn\n\t\t}\n\n\t\twsRef.send(JSON.stringify({ message: chatMessage, intent: 'chat' }))\n\t\tsetChatMessage('')\n\t}\n\n\tuseEffect(() => {\n\t\tconst ws = new WebSocket('ws://localhost:1338/' + localStorage.getItem('token'))\n\n\t\tws.addEventListener(\n\t\t\t'open',\n\t\t\t() => {\n\t\t\t\tws.send(\n\t\t\t\t\tJSON.stringify({\n\t\t\t\t\t\tintent: 'old-messages',\n\t\t\t\t\t\tcount: 10\n\t\t\t\t\t})\n\t\t\t\t)\n\t\t\t},\n\t\t\t{ once: true }\n\t\t)\n\n\t\tws.addEventListener('error', () => {\n\t\t\talert('Please login first')\n\t\t\thistory.replace('/login')\n\t\t})\n\n\t\tws.addEventListener('message', (event) => {\n\t\t\tconst data = event.data\n\n\t\t\tconst message: any = processMessage(data)\n\n\t\t\tif (!message) return\n\n\t\t\tif (message.intent === 'chat') {\n\t\t\t\tsetChatMessages((oldMessages) => {\n\t\t\t\t\treturn [...oldMessages, message as Message]\n\t\t\t\t})\n\t\t\t} else if (message.intent === 'old-messages') {\n\t\t\t\tconsole.log(message.data, 'are the older messages')\n\t\t\t\tsetChatMessages(\n\t\t\t\t\tmessage.data\n\t\t\t\t\t\t.map((item: any) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tuser: item.email,\n\t\t\t\t\t\t\t\tmessage: item.message\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.reverse()\n\t\t\t\t)\n\t\t\t}\n\t\t})\n\n\t\tsetWSRef(ws)\n\n\t\treturn () => {\n\t\t\tws.close()\n\t\t}\n\t}, [])\n\n\t// TODO: Add another action which loads more messages\n\n\t// 1. another click handler for that button\n\t// 2. Should extract the smallest date of current messages\n\t// 3. Should send a new websocket request with old-messages but with date as the property // date as well as count\n\n\treturn (\n\t\t<div>\n\t\t\t<h1>Chat Page</h1>\n\t\t\t<div className=\"chat-box\">\n\t\t\t\t{chatMessages.map((message, index) => {\n\t\t\t\t\treturn (\n\t\t\t\t\t\t<ListItem alignItems=\"flex-start\" key={index}>\n\t\t\t\t\t\t\t<ListItemAvatar>\n\t\t\t\t\t\t\t\t<Avatar alt=\"Remy Sharp\" src=\"/static/images/avatar/1.jpg\" />\n\t\t\t\t\t\t\t</ListItemAvatar>\n\t\t\t\t\t\t\t<ListItemText\n\t\t\t\t\t\t\t\tprimary={message.user}\n\t\t\t\t\t\t\t\tsecondary={\n\t\t\t\t\t\t\t\t\t<React.Fragment>\n\t\t\t\t\t\t\t\t\t\t<Typography\n\t\t\t\t\t\t\t\t\t\t\tcomponent=\"span\"\n\t\t\t\t\t\t\t\t\t\t\tvariant=\"body2\"\n\t\t\t\t\t\t\t\t\t\t\tcolor=\"textPrimary\"\n\t\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\t\t{message.message}\n\t\t\t\t\t\t\t\t\t\t</Typography>\n\t\t\t\t\t\t\t\t\t</React.Fragment>\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t</ListItem>\n\n\t\t\t\t\t\t// <div className=\"message\" key={index}>\n\t\t\t\t\t\t// \t<div className=\"author\">{message.user}</div>\n\t\t\t\t\t\t// \t<div className=\"text\">{message.message}</div>\n\t\t\t\t\t\t// </div>\n\t\t\t\t\t)\n\t\t\t\t})}\n\t\t\t</div>\n\n\t\t\t<TextField\n\t\t\t\tonChange={(e) => setChatMessage(e.target.value)}\n\t\t\t\tvalue={chatMessage}\n\t\t\t\tmultiline\n\t\t\t\trows={2}\n\t\t\t\tvariant=\"outlined\"\n\t\t\t\tcolor=\"primary\"\n\t\t\t/>\n\n\t\t\t<Button variant=\"outlined\" color=\"primary\" onClick={sendMessage}>\n\t\t\t\tSend Message\n\t\t\t</Button>\n\t\t</div>\n\t)\n}\n","import React from 'react'\nimport { BrowserRouter as Router, Switch, Route } from 'react-router-dom'\nimport Home from './Home'\nimport Login from './Login'\nimport Register from './Register'\nimport Chat from './Chat'\n\nfunction App() {\n\treturn (\n\t\t<Router>\n\t\t\t<Switch>\n\t\t\t\t<Route path=\"/\" component={Home} exact />\n\t\t\t\t<Route path=\"/login\" component={Login} exact />\n\t\t\t\t<Route path=\"/register\" component={Register} exact />\n\t\t\t\t<Route path=\"/chat\" component={Chat} exact />\n\t\t\t</Switch>\n\t\t</Router>\n\t)\n}\n\nexport default App\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport './index.css'\nimport App from './components'\n\nReactDOM.render(\n\t<React.StrictMode>\n\t\t<App />\n\t</React.StrictMode>,\n\tdocument.getElementById('root')\n)\n"],"sourceRoot":""}